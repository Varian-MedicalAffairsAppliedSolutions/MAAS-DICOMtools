<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DICOM Tools</title>
    <script>
        (function enforceRegistrationGate(){
            try {
                var isRegistered = localStorage.getItem('combinedapp_registered');
                var token = localStorage.getItem('combinedapp_registration_token');
                if (isRegistered !== 'true' || token !== '436804B1') {
                    var qs = window.location.search || '';
                    window.location.replace('gate/index.html' + qs);
                }
            } catch (e) {
                var qs2 = window.location.search || '';
                window.location.replace('gate/index.html' + qs2);
            }
        })();
    </script>
    <link rel="stylesheet" href="./styles.css" />
    <style>
      .machine-mapping-item {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }
      .machine-mapping-item input {
        flex: 1;
        max-width: 120px;
      }
      .machine-mapping-item span {
        font-weight: bold;
        color: var(--siemens-petrol);
      }
      .remove-mapping:hover {
        background: #d32f2f !important;
      }
      #addMachineMapping:hover {
        background: #e65100 !important;
      }
    </style>
  </head>
  <body>
    <div style="background: var(--error); color: #ffffff; text-align: center; padding: 8px 16px; font-weight: 700; letter-spacing: 0.03em; border-bottom: 1px solid var(--panel-border); position: sticky; top: 0; z-index: 1002;">
      **Not Validated for Clinical Use**
    </div>
    <div class="app">
      <header>
        <h1>DICOM Tools</h1>
        <div class="right-header">
          <div class="top-nav">
            <div class="nav-dropdown">
              <button class="viewer-btn dropdown-btn active" id="navDicomOps">
                Export ▼
              </button>
              <div class="dropdown-menu" id="dicomOpsMenu">
                <button class="dropdown-item active" id="navRetrieve" data-operation="export">Export</button>
                <button class="dropdown-item" id="navStore" data-operation="import">Import</button>
                <button class="dropdown-item" id="navSearch" data-operation="search">Search</button>
                <button class="dropdown-item" id="navShow" data-operation="show">Show</button>
              </div>
            </div>
            <button class="viewer-btn" id="navHelp">Help</button>
            <button class="viewer-btn" id="navConfig">Settings</button>
          </div>
        </div>
      </header>
      <div id="export-info" style="padding:0 16px;margin:-8px 0 8px 0;"></div>
      <main>
        <section class="panel" id="panelRetrieve">
          <div class="panel-title">Export</div>
          <div class="row">
            <label>Patient ID</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="patientId" placeholder="e.g. 12345" style="flex: 1;" />
              <button class="action-btn secondary" id="btnImportJson" title="Import patient list from Patient Browser">Import JSON</button>
            </div>
          </div>
          <div class="row">
            <label>Export Path</label>
            <input id="exportPath" placeholder="C:\\Temp\\DICOMExport" />
          </div>
          <div class="row">
            <label>Plan ID (Optional)</label>
            <input id="planId" placeholder="Leave empty for all plans, or enter specific plan ID" />
            <span style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
              Tip: Plans selected in Patient List Builder are automatically loaded here
            </span>
          </div>
          <div class="row">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="onlyApprovedPlans" style="width: auto; margin: 0;" />
              <span>Only Export Approved Plans</span>
            </label>
          </div>
          <div class="row">
            <label>Server Settings</label>
            <span style="color: var(--text-secondary); font-size: 13px;">Configure Host/Port/AETs under Settings → DICOM Server Settings</span>
          </div>
          <div class="row">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="includeObjectives" style="width: auto; margin: 0;" />
              <span>Include Optimization Objectives (if available)</span>
            </label>
          </div>
          <div class="row">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="anonymize" style="width: auto; margin: 0;" />
              <span>Anonymize Patient Data</span>
            </label>
          </div>
          <div id="anonymizationFields" style="display: none; margin-left: 24px; padding: 12px; background: var(--input-bg); border-left: 3px solid var(--siemens-orange); border-radius: 4px;">
            <div class="row">
              <label>New Patient ID</label>
              <input id="newPatientId" placeholder="e.g. ANON001" />
            </div>
            <div class="row">
              <label>New Patient Name</label>
              <input id="newPatientName" placeholder="e.g. Anonymous^Patient" />
            </div>
            <div class="warning-box" style="margin-top: 8px; font-size: 12px;">
              <strong>Note:</strong> Anonymization uses ARIA-compatible security profile. Both New Patient ID and New Patient Name are required when anonymization is enabled.
            </div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="action-btn primary" id="btnRetrieve">Run Export</button>
            <button class="action-btn secondary" id="btnClear">Clear</button>
            <button class="action-btn secondary" id="btnSaveRetrieve">Save Settings</button>
          </div>
          <pre id="output"></pre>
        </section>
        <section class="panel" id="panelStore" style="display:none;margin-top:12px">
          <div class="panel-title">Import</div>
          <div class="row">
            <label>Source Path</label>
            <input id="storePath" placeholder="C:\\Temp\\DICOMExport" />
          </div>
          <div class="row">
            <label>Server Settings</label>
            <span style="color: var(--text-secondary); font-size: 13px;">Configure Host/Port/AETs under Settings → DICOM Server Settings</span>
          </div>
          <div class="row">
            <label>Status File</label>
            <input id="statusFileName" placeholder="C:\\Temp\\store-status.txt" />
          </div>
          <div class="row">
            <label>Search Pattern</label>
            <input id="storeSearchPattern" placeholder="*.dcm" value="*.dcm" />
          </div>
          <div class="row">
            <label>Machine Mapping</label>
            <div id="machineMappingContainer">
              <div class="machine-mapping-item">
                <input type="text" class="machine-from" placeholder="From (e.g., A)" />
                <span>=</span>
                <input type="text" class="machine-to" placeholder="To (e.g., B)" />
                <button type="button" class="remove-mapping" style="background: var(--error); color: white; border: none; padding: 4px 8px; margin-left: 8px; border-radius: 3px; cursor: pointer;">−</button>
              </div>
            </div>
            <button type="button" id="addMachineMapping" style="background: var(--siemens-orange); color: white; border: none; padding: 6px 12px; margin-top: 8px; border-radius: 3px; cursor: pointer;">+ Add Machine Mapping</button>
          </div>
          <div class="row">
            <label>Default Machines</label>
            <input id="defaultMachines" placeholder="RDS=HALCYON 23EX=D" />
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="action-btn primary" id="btnStore">Run Import</button>
            <button class="action-btn secondary" id="btnClear">Clear</button>
            <button class="action-btn secondary" id="btnSaveStore">Save Settings</button>
          </div>
          <pre id="output"></pre>
        </section>
        <section class="panel" id="panelSearch" style="display:none;margin-top:12px">
          <div class="panel-title">Search</div>
          <div class="row">
            <label>Path</label>
            <input id="searchPath" placeholder="C:\\Data" />
          </div>
          <div class="row">
            <label>Search Pattern</label>
            <input id="searchPattern" placeholder="*.dcm" value="*.dcm" />
          </div>
          <div class="row">
            <label>Tags</label>
            <input id="searchTags" placeholder="(0010,0020)=ID (0008,0060)=?" />
          </div>
          <div class="row">
            <label><input type="checkbox" id="showStatistics" /> Show Statistics</label>
            <label><input type="checkbox" id="showOnlyDirectories" /> Only Directories</label>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="action-btn primary" id="btnSearch">Run Search</button>
            <button class="action-btn secondary" id="btnClear">Clear</button>
            <button class="action-btn secondary" id="btnSaveSearch">Save Settings</button>
          </div>
          <pre id="output"></pre>
        </section>
        <section class="panel" id="panelShow" style="display:none;margin-top:12px">
          <div class="panel-title">Show</div>
          <div class="row">
            <label>Path</label>
            <input id="showPath" placeholder="C:\\Data" />
          </div>
          <div class="row">
            <label>Search Pattern</label>
            <input id="showSearchPattern" placeholder="*.dcm" value="*.dcm" />
          </div>
          <div class="row">
            <label>Format</label>
            <input id="showFormat" placeholder="tree" />
          </div>
          <div class="row">
            <label>Default Machines</label>
            <input id="showDefaultMachines" placeholder="RDS=HALCYON 23EX=D" />
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="action-btn primary" id="btnShow">Run Show</button>
            <button class="action-btn secondary" id="btnClear">Clear</button>
            <button class="action-btn secondary" id="btnSaveShow">Save Settings</button>
          </div>
          <pre id="output"></pre>
        </section>

        <section class="panel" id="panelHelp" style="display:none;margin-top:12px">
          <div class="panel-title">Help & About</div>
          
          <div class="help-content">
            <div class="help-section">
              <h3>DICOM Tools</h3>
              <p><strong>Version 1.2.1</strong> - Educational/Research Use Only</p>
              <p>A comprehensive suite of DICOM utilities for healthcare data management, built on .NET 8 and the fo-dicom library.</p>
              <p><strong>⚡ NEW:</strong> Selective plan retrieval for up to 90% faster exports when filtering by plan ID or approval status!</p>
            </div>

            <div class="help-section">
              <h3>Available Tools</h3>
              <div class="tool-list">
                <div class="tool-item">
                  <strong>Export (Retrieve):</strong> Retrieve patient data using DICOM Query/Retrieve from PACS systems.
                </div>
                <div class="tool-item">
                  <strong>Import (Store):</strong> Store DICOM files to PACS systems using C-STORE protocol.
                </div>
                <div class="tool-item">
                  <strong>Search:</strong> Search DICOM tag values recursively through directory structures.
                </div>
                <div class="tool-item">
                  <strong>Show:</strong> Display DICOM data as hierarchical trees showing plan relationships and file metadata.
                </div>
              </div>
            </div>

            <div class="help-section">
              <h3>Key Features</h3>
              <ul>
                <li><strong>Multi-Patient Support:</strong> Handle multiple patients' data simultaneously</li>
                <li><strong>Secure DICOM:</strong> TLS support for secure DICOM communications</li>
                <li><strong>C-GET & C-MOVE:</strong> Flexible retrieve methods for different PACS configurations</li>
                <li><strong>Anonymization:</strong> Built-in ARIA-compatible anonymization profiles</li>
                <li><strong>Treatment Unit Mapping:</strong> Flexible machine name mapping for cross-platform compatibility</li>
                <li><strong>Persistent Settings:</strong> Automatic form data persistence for workflow efficiency</li>
                <li><strong>Port Configuration:</strong> Easy DICOM listening port management through Settings page</li>
                <li><strong>Connectivity Testing:</strong> Built-in diagnostic tools for troubleshooting DICOM connections</li>
              </ul>
            </div>

            <div class="help-section">
              <h3>Configuration</h3>
              <p>Settings are automatically saved locally and restored between sessions. Use the "Save Settings" buttons to manually save current configurations.</p>
              <p><strong>Advanced:</strong> Configuration files (appsettings.json, options.json) allow detailed customization of DICOM parameters, logging levels, and anonymization profiles.</p>
            </div>

            <div class="help-section">
              <h3>DICOM Port Configuration</h3>
              <p>The <strong>Settings</strong> page provides easy management of DicomTools listening port configuration - essential for successful DICOM file retrieval.</p>
              
              <div class="tool-list">
                <div class="tool-item">
                  <strong>Port 104:</strong> Standard DICOM port (may require administrator privileges)
                </div>
                <div class="tool-item">
                  <strong>Port 11112:</strong> Alternative high port (no administrator privileges needed)
                </div>
                <div class="tool-item">
                  <strong>Port 4242:</strong> Common DICOM test port for development environments
                </div>
              </div>
              
              <p><strong>Important:</strong> The listening port in DicomTools must match what your PACS/Eclipse is configured to send retrieved files to. Port mismatches are a common cause of "successful" retrieve operations that don't actually transfer files.</p>
            </div>

            <div class="help-section">
              <h3>Connectivity Testing Tools</h3>
              <p>The Settings page includes professional-grade diagnostic tools to troubleshoot DICOM connectivity issues:</p>
              
              <div class="tool-list">
                <div class="tool-item">
                  <strong>Network Test:</strong> Verifies basic network connectivity to your PACS server, tests port accessibility, and checks local port availability.
                </div>
                <div class="tool-item">
                  <strong>DICOM Connection Test:</strong> Tests actual DICOM query capability with your PACS, verifies AET configuration, and checks file transfer functionality.
                </div>
                <div class="tool-item">
                  <strong>Port Listening Test:</strong> Confirms DicomTools can successfully bind to your configured port and provides administrator privilege guidance.
                </div>
                <div class="tool-item">
                  <strong>Complete Diagnostic:</strong> Comprehensive 4-phase test covering system checks, network connectivity, DICOM communication, and system information with detailed recommendations.
                </div>
              </div>
              
              <p><strong>Usage:</strong> All tests generate downloadable batch files that must be placed in the same directory as DicomTools.exe before execution. Tests provide detailed analysis and troubleshooting guidance.</p>
            </div>

            <div class="help-section">
              <h3>Security & Compliance</h3>
              <div class="warning-box">
                <strong>Important:</strong> This software is for educational and research purposes only. It has NOT been validated for clinical use and should not be used in patient care environments.
              </div>
              <p>The software includes ARIA Security Profile and Basic Security Profile anonymization options compliant with DICOM PS3.15 standards.</p>
            </div>

            <div class="help-section">
              <h3>Network Requirements</h3>
              <ul>
                <li><strong>DICOM Ports:</strong> Typically 4242 (configurable)</li>
                <li><strong>Firewall:</strong> Bidirectional TCP/IP access between client and PACS</li>
                <li><strong>Offline Capable:</strong> Core functionality works without internet access</li>
                <li><strong>Local Network:</strong> DICOM operations require local network access to PACS systems</li>
              </ul>
            </div>

            <div class="help-section">
              <h3>Quick Start</h3>
              <ol>
                <li><strong>Export:</strong> Enter Patient ID, optionally specify Plan ID, set export path, enable anonymization if needed, configure DICOM server details</li>
                <li><strong>Import:</strong> Select source folder, configure target PACS, map treatment units if needed</li>
                <li><strong>Search:</strong> Specify DICOM tags and search patterns to find specific data</li>
                <li><strong>Show:</strong> Preview DICOM file contents and metadata before operations</li>
              </ol>
            </div>

            <div class="help-section">
              <h3>Plan Filtering (Performance Optimization)</h3>
              <p><strong>⚡ NEW IN V1.2.1:</strong> Selective retrieval dramatically reduces data transfer!</p>
              <p>When you specify <strong>Plan ID</strong> or enable <strong>Only Approved Plans</strong>, DicomTools now uses intelligent selective retrieval:</p>
              <ul>
                <li><strong>✓ Filters RT-Plans FIRST</strong> before downloading data</li>
                <li><strong>✓ Only retrieves referenced data</strong> (structure sets, doses, images) for matching plans</li>
                <li><strong>✓ Skips unneeded data entirely</strong> - saving up to 90% bandwidth and time!</li>
              </ul>
              <p><strong>How to Use:</strong></p>
              <ul>
                <li><strong>Plan ID:</strong> Export only a specific plan (e.g., "VMAT_60Gy")</li>
                <li><strong>Only Approved Plans:</strong> Automatically filter to approved plans only</li>
                <li><strong>Auto-Population:</strong> Plans selected in Patient List Builder are automatically loaded</li>
                <li><strong>Leave Empty:</strong> Exports ALL patient data (original behavior, may be slower)</li>
              </ul>
              <p><strong>Example:</strong> Patient with 10 plans, you select 1 plan → Downloads only that plan's data instead of all 10 plans!</p>
              <p><strong>Tip:</strong> Always specify plan filters when exporting from patients with many plans for fastest performance.</p>
            </div>

            <div class="help-section">
              <h3>Anonymization</h3>
              <p>The Export operation now supports ARIA-compatible patient data anonymization:</p>
              <ul>
                <li><strong>Enable Anonymization:</strong> Check the "Anonymize Patient Data" checkbox in Export settings</li>
                <li><strong>Required Fields:</strong> Both New Patient ID and New Patient Name must be provided</li>
                <li><strong>Security Profile:</strong> Uses AriaSecurityProfile.csv (DCIE-compatible, retains device identification)</li>
                <li><strong>Single Patient:</strong> Exported to folder named with anonymized ID (e.g., ANON001)</li>
                <li><strong>Multiple Patients:</strong> Automatically sequenced with unique IDs (e.g., ANON001-01, ANON001-02, ANON001-03)</li>
                <li><strong>Folder Security:</strong> Export folders are named using anonymized IDs to prevent patient identification</li>
              </ul>
              <p><strong>Example:</strong> Input "ANON001" for 3 patients → Exports to folders ANON001-01, ANON001-02, ANON001-03 with unique anonymized patient data.</p>
            </div>

            <div class="help-section">
              <h3>Keyboard Shortcuts</h3>
              <ul>
                <li><strong>Ctrl + Shift + X:</strong> Clear all saved settings (reset form data)</li>
                <li><strong>Tab Navigation:</strong> Use Tab key to navigate between form fields</li>
                <li><strong>Enter:</strong> Submit forms and execute commands</li>
              </ul>
            </div>

            <div class="help-section">
              <h3>Troubleshooting</h3>
              <ul>
                <li><strong>Export Shows Success But No Files:</strong> Most likely a port mismatch - use Settings → Port Listening Test to verify configuration</li>
                <li><strong>Connection Issues:</strong> Use Settings → Network Test to verify connectivity, then DICOM Connection Test for protocol-specific issues</li>
                <li><strong>Import Failures:</strong> Check treatment unit mapping and verify file permissions</li>
                <li><strong>Port Binding Errors:</strong> Run Settings → Port Listening Test; may need administrator privileges for port 104</li>
                <li><strong>PACS Communication:</strong> Use Settings → Complete Diagnostic for comprehensive analysis of all connectivity aspects</li>
                <li><strong>Browse Buttons:</strong> If file dialogs don't open, restart the application</li>
                <li><strong>Settings Not Saving:</strong> Data is saved automatically; try refreshing the page</li>
              </ul>
              
              <div class="warning-box">
                <strong>Quick Diagnostic Tip:</strong> If retrieve operations show "success" but no files are exported, this is typically a port configuration mismatch. Use the Settings page to verify your listening port matches your PACS configuration.
              </div>
            </div>

            <div class="help-section">
              <h3>Technical Details</h3>
              <p><strong>Built with:</strong> .NET 8, fo-dicom library, Electron framework</p>
              <p><strong>Platform:</strong> Windows (portable executable available)</p>
              <p><strong>Dependencies:</strong> .NET 8 Runtime (included in portable build)</p>
            </div>

            <div class="help-section">
              <h3>License</h3>
              <p>This software is subject to the Varian Limited Use Software License Agreement. By using this tool, you acknowledge compliance with all terms and conditions.</p>
              <p><a href="gate/VarianLUSLA.html" target="_blank" class="license-link">View License Agreement</a></p>
            </div>

            <div class="help-section" style="border-top: 1px solid var(--panel-border); padding-top: 16px; margin-top: 24px;">
              <p style="text-align: center; color: var(--text-secondary); font-size: 0.9em;">
                <strong>DICOM Tools v1.2.1</strong><br>
                Educational/Research Use Only • Not for Clinical Use
              </p>
            </div>
          </div>
        </section>

        <section class="panel" id="panelConfig" style="display:none;margin-top:12px">
          <div class="panel-title">Local Configuration</div>
          
          <div class="help-content">
            <div class="help-section">
              <h3>DICOM Listening Port</h3>
              <p>Configure the port DicomTools uses to receive DICOM files during export operations.</p>
              
              <div class="row">
                <label>Listening Port</label>
                <input id="listeningPort" type="number" min="1" max="65535" placeholder="104" value="104" />
              </div>
              
              <div class="row">
                <label>Current Status</label>
                <span id="portStatus" style="color: var(--text-secondary);">Port configuration loaded from appsettings.json</span>
              </div>
              
              <div style="display:flex;gap:8px;align-items:center;margin-top:16px">
                <button class="action-btn primary" id="btnUpdatePort">Update Port Configuration</button>
                <button class="action-btn secondary" id="btnReloadPort">Reload Current</button>
              </div>
              
              <div class="warning-box" style="margin-top:16px">
                <strong>Important:</strong> After changing the port, you must restart DicomTools for changes to take effect. 
                Standard DICOM port is 104, but may require administrator privileges.
                <br><br>
                <strong>Port Guidelines:</strong>
                <ul style="margin: 8px 0 0 16px;">
                  <li><strong>104:</strong> Standard DICOM port (may need admin rights)</li>
                  <li><strong>11112:</strong> Alternative high port (no admin needed)</li>
                  <li><strong>4242:</strong> Common DICOM test port</li>
                </ul>
              </div>
            </div>

            

            <div class="help-section">
              <h3>DICOM Server Settings</h3>
              <p>These settings are shared by Export and Import operations.</p>

              <div class="row grid">
                <div>
                  <label>Host Name</label>
                  <input id="hostName" placeholder="localhost" />
                </div>
                <div>
                  <label>Host Port</label>
                  <input id="hostPort" placeholder="4242" />
                </div>
              </div>

              <div class="row grid">
                <div>
                  <label>Calling AET</label>
                  <input id="callingAet" placeholder="MYAET" />
                </div>
                <div>
                  <label>Called AET</label>
                  <input id="calledAet" placeholder="SCPAET" />
                </div>
              </div>

              <div class="row">
                <label>DicomTools Path</label>
                <input id="dicomToolsPath" placeholder="C:\\Path\\To\\DicomToolsFolder" />
              </div>

              <div style="display:flex;gap:8px;align-items:center;margin-top:16px">
                <button class="action-btn primary" id="btnSaveServerSettings">Save Server Settings</button>
              </div>

              <div class="row" style="margin-top:16px">
                <label>Test Patient ID</label>
                <input id="testPatientId" placeholder="test1" />
              </div>

              <div style="display:flex;gap:8px;align-items:center;margin-top:16px;flex-wrap:wrap">
                <button class="action-btn primary" id="btnTestNetworkConnectivity">Network Test</button>
                <button class="action-btn primary" id="btnTestDicomConnection">DICOM Connection Test</button>
                <button class="action-btn primary" id="btnTestPortListening">Port Listening Test</button>
                <button class="action-btn secondary" id="btnTestComplete">Complete Diagnostic</button>
              </div>

              <div id="configOutput" style="margin-top:16px;padding:12px;background:var(--input-bg);border:1px solid var(--panel-border);border-radius:4px;font-family:monospace;font-size:12px;white-space:pre-wrap;display:none;"></div>

              <div class="warning-box" style="margin-top:16px">
                <strong>Test Descriptions:</strong>
                <ul style="margin: 8px 0 0 16px;">
                  <li><strong>Network Test:</strong> Ping host and check port accessibility</li>
                  <li><strong>DICOM Connection Test:</strong> Test query capability with Eclipse</li>
                  <li><strong>Port Listening Test:</strong> Verify DicomTools can bind to configured port</li>
                  <li><strong>Complete Diagnostic:</strong> All tests + detailed troubleshooting</li>
                </ul>
              </div>
            </div>

            <div class="help-section">
              <h3>Configuration Files</h3>
              <p>DicomTools configuration is stored in <code>appsettings.json</code>. Changes made here will update this file.</p>
              
              <div style="display:flex;gap:8px;align-items:center">
                <button class="action-btn secondary" id="btnBackupConfig">Create Backup</button>
                <button class="action-btn secondary" id="btnResetConfig">Reset to Defaults</button>
              </div>
            </div>

            <div class="help-section">
              <h3>Logging Level</h3>
              <p>Adjust the verbosity of DicomTools logging output.</p>
              
              <div class="row">
                <label>Log Level</label>
                <select id="logLevel">
                  <option value="Error">Error - Only errors</option>
                  <option value="Warning">Warning - Errors and warnings</option>
                  <option value="Information">Information - Normal output</option>
                  <option value="Debug">Debug - Detailed diagnostics</option>
                </select>
              </div>
              
              <div style="display:flex;gap:8px;align-items:center;margin-top:16px">
                <button class="action-btn primary" id="btnUpdateLogging">Update Logging</button>
              </div>
            </div>
          </div>
        </section>
      </main>
      
      <footer style="text-align: center; padding: 16px; border-top: 1px solid var(--panel-border); margin-top: 20px; background: var(--panel-bg);">
        <a href="gate/VarianLUSLA.html" target="_blank" style="color: var(--siemens-petrol); text-decoration: underline; font-size: 16px; font-weight: bold;">
          Varian Limited Use Software License Agreement
        </a>
      </footer>
    </div>
    
    
    
    <!-- Load handoff data from Patient List Builder (if present) -->
    <script src="./handoff_patients.js"></script>
    <script src="./app.js"></script>
  </body>
  </html>


